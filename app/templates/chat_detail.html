{% extends "base.html" %}
{% block title %}–ß–∞—Ç{% endblock %}

{% block content %}
<h2 class="mb-4">–ß–∞—Ç —Å {{ other_user.username }}</h2>

<style>
  .chat-box {
    border: 1px solid #ccc;
    border-radius: 10px;
    padding: 15px;
    height: 400px;
    overflow-y: auto;
    background-color: #f9f9f9;
  }

  .message {
    position: relative;
    padding: 10px 14px;
    margin: 10px 0;
    border-radius: 15px;
    max-width: 60%;
    clear: both;
    word-wrap: break-word;
    color: #000;
  }

  .from-me {
    background-color: #dcf8c6;
    float: right;
    text-align: right;
  }

  .from-them {
    background-color: #ffffff;
    border: 1px solid #ddd;
    float: left;
  }

  .message .actions {
    font-size: 0.8em;
    margin-top: 6px;
  }

  .message .actions form {
    display: inline-block;
    margin-right: 5px;
  }

  .message strong {
    display: block;
    font-size: 0.8em;
    color: #555;
    margin-bottom: 4px;
  }
</style>

<div class="chat-box mb-4">
  {% for message in messages %}
    <div class="message {% if message.sender_id == current_user.id %}from-me{% else %}from-them{% endif %}">
      <strong>{{ message.sender.username }}</strong>
      <div>{{ message.text }}</div>

      {% if message.sender_id == current_user.id %}
      <div class="actions">
        <form action="{{ url_for('main.edit_message', chat_id=chat.id, message_id=message.id) }}" method="post">
          {{ csrf_token() }}
          <input type="text" name="text" value="{{ message.text }}" class="form-control form-control-sm mb-1" />
          <button class="btn btn-sm btn-outline-secondary" type="submit">‚úèÔ∏è</button>
        </form>
        <form action="{{ url_for('main.delete_message', chat_id=chat.id, message_id=message.id) }}" method="post">
          {{ csrf_token() }}
          <button class="btn btn-sm btn-outline-danger" type="submit">üóëÔ∏è</button>
        </form>
      </div>
      {% endif %}
    </div>
  {% endfor %}
</div>

<form method="post">
  {{ form.hidden_tag() }}
  <div class="form-group mb-2">
    {{ form.body(class="form-control", rows=2, placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ...") }}
  </div>
  <div class="form-group">
    {{ form.submit(class="btn btn-primary") }}
  </div>
</form>
{% endblock %}

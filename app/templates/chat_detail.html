{% extends 'base.html' %}
{% block content %}
<h2>–ß–∞—Ç —Å {{ chat.user1.username if chat.user2_id == current_user.id else chat.user2.username }}</h2>

<div style="border:1px solid #ccc; padding:10px; max-height:400px; overflow-y:scroll;">
    {% for msg in messages %}
        <div style="margin-bottom:10px;">
            <strong>{{ msg.sender.username }}</strong>:
            {% if editing_id == msg.id %}
                <form method="POST" action="{{ url_for('main.edit_message', chat_id=chat.id, message_id=msg.id) }}">
                    <input type="text" name="text" value="{{ msg.text }}">
                    <button type="submit">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                    <a href="{{ url_for('main.chat_detail', chat_id=chat.id) }}">–û—Ç–º–µ–Ω–∞</a>
                </form>
            {% else %}
                {{ msg.text }}
                {% if msg.sender_id == current_user.id %}
                    <form method="POST" action="{{ url_for('main.delete_message', chat_id=chat.id, message_id=msg.id) }}" style="display:inline;">
                        <button type="submit" onclick="return confirm('–£–¥–∞–ª–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ?')">üóë</button>
                    </form>
                    <a href="{{ url_for('main.chat_detail', chat_id=chat.id, edit=msg.id) }}">‚úè</a>
                {% endif %}
            {% endif %}
            <div style="font-size:small; color:gray;">{{ msg.timestamp.strftime('%d.%m.%Y %H:%M') }}</div>
        </div>
    {% endfor %}
</div>

<form method="POST">
    <input type="text" name="text" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ" required>
    <button type="submit">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
</form>
{% endblock %}
